<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolanaÈÉ®ÁΩ≤Áª≠‰º†Â∑•ÂÖ∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .card h3 {
            margin-bottom: 16px;
            color: #2d3748;
            display: flex;
            align-items: center;
        }
        
        .card h3::before {
            content: "";
            width: 4px;
            height: 20px;
            background: #667eea;
            margin-right: 12px;
            border-radius: 2px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 12px 0;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #4a5568;
        }
        
        .metric-value {
            font-weight: 600;
            color: #2d3748;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #2f855a;
        }
        
        .status.warning {
            background: #faf0ce;
            color: #b7791f;
        }
        
        .status.error {
            background: #fed7e2;
            color: #c53030;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
            width: 100%;
            margin-bottom: 8px;
        }
        
        .btn:hover {
            background: #5a67d8;
        }
        
        .btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn.secondary:hover {
            background: #cbd5e0;
        }
        
        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        
        .deployment-list {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .deployment-item {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .deployment-item:last-child {
            border-bottom: none;
        }
        
        .deployment-info h4 {
            margin-bottom: 4px;
            color: #2d3748;
        }
        
        .deployment-info p {
            color: #718096;
            font-size: 0.9rem;
        }
        
        .deployment-actions {
            display: flex;
            gap: 8px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .feature-description {
            background: #f7fafc;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 0.9rem;
            color: #4a5568;
            border-left: 4px solid #667eea;
        }
        
        .feature-description h4 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #2d3748;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .form-group small {
            color: #718096;
            font-size: 0.8rem;
        }

        .keypair-selector {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .keypair-selector input[type="text"] {
            flex: 1;
        }

        .btn-secondary {
            background: #4a5568;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-secondary:hover {
            background: #2d3748;
        }

        .status-text {
            font-weight: 500;
        }

        .status-text.success {
            color: #38a169;
        }

        .status-text.warning {
            color: #dd6b20;
        }

        .status-text.error {
            color: #e53e3e;
        }
        
        .log-output {
            background: #1a202c;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.8rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ SolanaÈÉ®ÁΩ≤Áª≠‰º†Â∑•ÂÖ∑</h1>
            <p>Êô∫ËÉΩÈÉ®ÁΩ≤ÁÆ°ÁêÜ ¬∑ Êñ≠ÁÇπÁª≠‰º† ¬∑ Ë¥πÁî®‰ºòÂåñ</p>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h3>üìä ÈÉ®ÁΩ≤ÁªüËÆ°</h3>
                <div class="metric">
                    <span class="metric-label">ÊÄªÈÉ®ÁΩ≤Êï∞</span>
                    <span class="metric-value" id="total-deployments">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ÊàêÂäüÁéá</span>
                    <span class="metric-value" id="success-rate">0%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ËäÇÁúÅË¥πÁî®</span>
                    <span class="metric-value" id="saved-fees">0 SOL</span>
                </div>
            </div>
            
            <div class="card">
                <h3>üåê ÁΩëÁªúÁä∂ÂÜµ</h3>
                <div class="metric">
                    <span class="metric-label">RPCÂª∂Ëøü</span>
                    <span class="metric-value" id="network-latency">
                        <span class="loading"></span>
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">ÁΩëÁªúÊã•Â†µ</span>
                    <span class="metric-value" id="congestion-level">
                        <span class="status warning">Ê£ÄÊµã‰∏≠</span>
                    </span>
                </div>
                <div class="metric">
                    <span class="metric-label">GasË¥πÁî®</span>
                    <span class="metric-value" id="gas-price">-- SOL</span>
                </div>
            </div>
            
            <div class="card">
                <h3>‚ö° ‰∏ªË¶ÅÂäüËÉΩ</h3>
                
                <div class="feature-description">
                    <h4>üÜï Êñ∞Âª∫ÈÉ®ÁΩ≤</h4>
                    <p>Êô∫ËÉΩÂàÜÊûê.soÊñá‰ª∂ÔºåËá™Âä®ÊãÜÂàÜ‰∏ä‰º†ÔºåÂÆûÊó∂ÁõëÊéßÈÉ®ÁΩ≤ËøõÂ∫¶„ÄÇÊîØÊåÅLoader-v3/v4Ôºå‰ºòÂåñ‰∫§ÊòìË¥πÁî®„ÄÇ</p>
                </div>
                <button class="btn" onclick="openNewDeploymentModal()">Êñ∞Âª∫ÈÉ®ÁΩ≤</button>
                
                <div class="feature-description" style="border-left-color: #f56565;">
                    <h4>üß™ ÊµãËØïÂ§±Ë¥•ÈÉ®ÁΩ≤</h4>
                    <p>Ê®°ÊãüÈÉ®ÁΩ≤Â§±Ë¥•Âú∫ÊôØÔºåÊµãËØïÁª≠‰º†ÂäüËÉΩ„ÄÇÁî®‰∫éÈ™åËØÅÊñ≠ÁÇπÁª≠‰º†ÁöÑÂèØÈù†ÊÄß„ÄÇ</p>
                </div>
                <button class="btn" style="background: #f56565;" onclick="openFailureTestModal()">Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤</button>
                
                <div class="feature-description">
                    <h4>üîÑ Êâ´ÊèèÂèØÁª≠‰º†</h4>
                    <p>Ëá™Âä®Êâ´ÊèèÂ§±Ë¥•ÁöÑBufferË¥¶Êà∑ÔºåËØÑ‰º∞Áª≠‰º†‰ª∑ÂÄºÔºå‰∏ÄÈîÆÊÅ¢Â§ç‰∏≠Êñ≠ÁöÑÈÉ®ÁΩ≤‰ªªÂä°„ÄÇ</p>
                </div>
                <button class="btn secondary" onclick="scanResumable()">Êâ´ÊèèÂèØÁª≠‰º†</button>
                
                <div class="feature-description">
                    <h4>üìà ÁΩëÁªúÂàÜÊûê</h4>
                    <p>ÂÆûÊó∂ÁõëÊéßSolanaÁΩëÁªúÁä∂ÂÜµÔºåÂàÜÊûêÊúÄ‰Ω≥ÈÉ®ÁΩ≤Êó∂Êú∫ÔºåÊèê‰æõË¥πÁî®‰ºòÂåñÂª∫ËÆÆ„ÄÇ</p>
                </div>
                <button class="btn secondary" onclick="analyzeNetwork()">ÁΩëÁªúÂàÜÊûê</button>
            </div>
        </div>
        
        <div class="deployment-list">
            <h3>üìã ÈÉ®ÁΩ≤ÂéÜÂè≤</h3>
            <div id="deployment-items">
                <div class="deployment-item">
                    <div class="deployment-info">
                        <h4>ÊöÇÊó†ÈÉ®ÁΩ≤ËÆ∞ÂΩï</h4>
                        <p>ÂºÄÂßãÊÇ®ÁöÑÁ¨¨‰∏ÄÊ¨°ÈÉ®ÁΩ≤</p>
                    </div>
                    <div class="deployment-actions">
                        <span class="status">Á≠âÂæÖÊìç‰Ωú</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Êñ∞Âª∫ÈÉ®ÁΩ≤Ê®°ÊÄÅÊ°Ü -->
    <div id="newDeploymentModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>üÜï Êñ∞Âª∫ÈÉ®ÁΩ≤</h2>
            <form id="deploymentForm">
                <div class="form-group">
                    <label for="programFile">Á®ãÂ∫èÊñá‰ª∂(.so)</label>
                    <input type="file" id="programFile" accept=".so" required>
                    <small>ÈÄâÊã©Ë¶ÅÈÉ®ÁΩ≤ÁöÑSolanaÁ®ãÂ∫èÊñá‰ª∂</small>
                </div>
                
                <div class="form-group">
                    <label for="programName">Á®ãÂ∫èÂêçÁß∞</label>
                    <input type="text" id="programName" placeholder="‰æãÔºömy-program" required>
                    <small>‰∏∫ÊÇ®ÁöÑÁ®ãÂ∫èËµ∑‰∏Ä‰∏™ÂêçÁß∞</small>
                </div>
                
                <div class="form-group">
                    <label for="loaderVersion">Âä†ËΩΩÂô®ÁâàÊú¨</label>
                    <select id="loaderVersion" required>
                        <option value="v3">Loader-v3 (Êé®Ëçê)</option>
                        <option value="v4">Loader-v4 (ÂÆûÈ™åÊÄß)</option>
                    </select>
                    <small>ÈÄâÊã©Á®ãÂ∫èÂä†ËΩΩÂô®ÁâàÊú¨</small>
                </div>
                
                <div class="form-group">
                    <label for="rpcUrl">RPCÁ´ØÁÇπ</label>
                    <select id="rpcUrl">
                        <option value="mainnet">Mainnet (‰∏ªÁΩë)</option>
                        <option value="devnet" selected>Devnet (ÂºÄÂèëÁΩë)</option>
                        <option value="testnet">Testnet (ÊµãËØïÁΩë)</option>
                        <option value="localhost">Localhost</option>
                        <option value="custom">Ëá™ÂÆö‰πâRPC</option>
                    </select>
                </div>
                
                <div class="form-group" id="customRpcGroup" style="display: none;">
                    <label for="customRpc">Ëá™ÂÆö‰πâRPC URL</label>
                    <input type="url" id="customRpc" placeholder="https://api.mainnet-beta.solana.com">
                </div>
                
                <div class="form-group">
                    <label for="keypairPath">ÂØÜÈí•ÂØπÊñá‰ª∂</label>
                    <div class="keypair-selector">
                        <input type="file" id="keypairFile" accept=".json" style="display: none;">
                        <input type="text" id="keypairPath" placeholder="~/.config/solana/id.json" readonly>
                        <button type="button" id="selectKeypairBtn" class="btn-secondary">ÈÄâÊã©Êñá‰ª∂</button>
                        <button type="button" id="useDefaultBtn" class="btn-secondary">‰ΩøÁî®ÈªòËÆ§</button>
                    </div>
                    <small>
                        <span id="keypairStatus" class="status-text">Ê£ÄÊü•‰∏≠...</span><br>
                        ÈªòËÆ§Ë∑ØÂæÑ: ~/.config/solana/id.json
                    </small>
                </div>
                
                <button type="submit" class="btn">ÂºÄÂßãÈÉ®ÁΩ≤</button>
            </form>
            
            <div id="deploymentLog" class="log-output" style="display: none;"></div>
        </div>
    </div>
    
    <!-- Êâ´ÊèèÁªìÊûúÊ®°ÊÄÅÊ°Ü -->
    <div id="scanModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>üîÑ ÂèØÁª≠‰º†ÈÉ®ÁΩ≤Êâ´Êèè</h2>
            <div id="scanResults">
                <div class="loading"></div>
                <p>Ê≠£Âú®Êâ´ÊèèÂèØÁª≠‰º†ÁöÑÈÉ®ÁΩ≤...</p>
            </div>
        </div>
    </div>
    
    <!-- ÁΩëÁªúÂàÜÊûêÊ®°ÊÄÅÊ°Ü -->
    <div id="networkModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>üìà ÁΩëÁªúÂàÜÊûêÊä•Âëä</h2>
            <div id="networkAnalysis">
                <div class="loading"></div>
                <p>Ê≠£Âú®ÂàÜÊûêÁΩëÁªúÁä∂ÂÜµ...</p>
            </div>
        </div>
    </div>

    <!-- Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤Ê®°ÊÄÅÊ°Ü -->
    <div id="failureTestModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>üß™ Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤ÊµãËØï</h2>
            <div class="feature-description" style="margin-bottom: 20px;">
                <h4>‚ö†Ô∏è ÊµãËØïËØ¥Êòé</h4>
                <p>Ê≠§ÂäüËÉΩ‰ªÖÁî®‰∫éÊµãËØïÁª≠‰º†ÂäüËÉΩÔºå‰∏ç‰ºöËøõË°åÁúüÂÆûÁöÑÁ®ãÂ∫èÈÉ®ÁΩ≤„ÄÇÊ®°ÊãüÁöÑÂ§±Ë¥•ÂèØ‰ª•Â∏ÆÂä©ÊÇ®È™åËØÅÁª≠‰º†Êú∫Âà∂ÁöÑÂèØÈù†ÊÄß„ÄÇ</p>
            </div>
            
            <form id="failureTestForm">
                <div class="form-group">
                    <label for="testProgramFile">ÊµãËØïÁ®ãÂ∫èÊñá‰ª∂(.so)</label>
                    <input type="file" id="testProgramFile" accept=".so" required>
                    <small>ÈÄâÊã©Áî®‰∫éÊµãËØïÁöÑÁ®ãÂ∫èÊñá‰ª∂</small>
                </div>
                
                <div class="form-group">
                    <label for="testProgramName">ÊµãËØïÁ®ãÂ∫èÂêçÁß∞</label>
                    <input type="text" id="testProgramName" placeholder="my_test_program" required>
                    <small>‰∏∫ÊµãËØïÁ®ãÂ∫èÊåáÂÆö‰∏Ä‰∏™ÂêçÁß∞</small>
                </div>
                
                <div class="form-group">
                    <label for="testLoaderVersion">Âä†ËΩΩÂô®ÁâàÊú¨</label>
                    <select id="testLoaderVersion" required>
                        <option value="v4">Loader v4 (Êé®Ëçê)</option>
                        <option value="v3">Loader v3</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="testRpcUrl">RPCÁΩëÁªú</label>
                    <select id="testRpcUrl" required>
                        <option value="devnet">Devnet (ÂºÄÂèëÁΩëÁªú)</option>
                        <option value="testnet">Testnet (ÊµãËØïÁΩëÁªú)</option>
                        <option value="localhost">Êú¨Âú∞ÁΩëÁªú</option>
                        <option value="custom">Ëá™ÂÆö‰πâ</option>
                    </select>
                </div>
                
                <div class="form-group" id="testCustomRpcGroup" style="display: none;">
                    <label for="testCustomRpc">Ëá™ÂÆö‰πâRPC URL</label>
                    <input type="url" id="testCustomRpc" placeholder="https://api.mainnet-beta.solana.com">
                </div>
                
                <div class="form-group">
                    <label for="testKeypairPath">ÂØÜÈí•ÂØπÊñá‰ª∂</label>
                    <div class="keypair-selector">
                        <input type="file" id="testKeypairFile" accept=".json" style="display: none;">
                        <input type="text" id="testKeypairPath" placeholder="~/.config/solana/id.json" readonly>
                        <button type="button" id="testSelectKeypairBtn" class="btn-secondary">ÈÄâÊã©Êñá‰ª∂</button>
                        <button type="button" id="testUseDefaultBtn" class="btn-secondary">‰ΩøÁî®ÈªòËÆ§</button>
                    </div>
                    <small>
                        <span id="testKeypairStatus" class="status-text">Ê£ÄÊü•‰∏≠...</span><br>
                        ÈªòËÆ§Ë∑ØÂæÑ: ~/.config/solana/id.json
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="failureType">Â§±Ë¥•Á±ªÂûã</label>
                    <select id="failureType" required>
                        <option value="random">ÈöèÊú∫Â§±Ë¥• (30% Ê¶ÇÁéá)</option>
                        <option value="percentage">ÊåáÂÆöËøõÂ∫¶Â§±Ë¥•</option>
                        <option value="chunk">ÊåáÂÆöÂàÜÂùóÂ§±Ë¥•</option>
                        <option value="network">ÁΩëÁªú‰∏≠Êñ≠Ê®°Êãü</option>
                    </select>
                </div>
                
                <div class="form-group" id="failurePercentageGroup" style="display: none;">
                    <label for="failurePercentage">Â§±Ë¥•ËøõÂ∫¶(%)</label>
                    <input type="range" id="failurePercentage" min="10" max="90" value="50">
                    <span id="failurePercentageDisplay">50%</span>
                    <small>Âú®ËææÂà∞Ê≠§ËøõÂ∫¶Êó∂Ê®°ÊãüÂ§±Ë¥•</small>
                </div>
                
                <div class="form-group" id="failureChunkGroup" style="display: none;">
                    <label for="failureChunk">Â§±Ë¥•ÂàÜÂùóÂ∫èÂè∑</label>
                    <input type="number" id="failureChunk" min="1" max="100" value="3">
                    <small>Âú®Á¨¨N‰∏™ÂàÜÂùóÊó∂Â§±Ë¥•</small>
                </div>
                
                <button type="submit" class="btn" style="background: #f56565;">ÂºÄÂßãÊ®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤</button>
            </form>
            
            <div id="failureTestLog" class="log-output" style="display: none;"></div>
        </div>
    </div>
    
    <script>
        // ÂÖ®Â±ÄÁä∂ÊÄÅ
        let deployments = [];
        let wsConnection = null;
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            loadDeployments();
            setupEventListeners();
            connectWebSocket();
            checkDefaultKeypair(); // Ê£ÄÊü•ÈªòËÆ§ÂØÜÈí•ÂØπ
        });
        
        // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function setupEventListeners() {
            // Ê®°ÊÄÅÊ°ÜÂÖ≥Èó≠
            document.querySelectorAll('.close').forEach(close => {
                close.onclick = function() {
                    this.closest('.modal').style.display = 'none';
                }
            });
            
            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            window.onclick = function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            }
            
            // RPCÈÄâÊã©ÂèòÂåñ
            document.getElementById('rpcUrl').onchange = function() {
                const customGroup = document.getElementById('customRpcGroup');
                customGroup.style.display = this.value === 'custom' ? 'block' : 'none';
            };
            
            // ÂØÜÈí•ÂØπÈÄâÊã©
            document.getElementById('selectKeypairBtn').onclick = function() {
                document.getElementById('keypairFile').click();
            };
            
            document.getElementById('keypairFile').onchange = function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    document.getElementById('keypairPath').value = file.name;
                    validateKeypair(file);
                }
            };
            
            document.getElementById('useDefaultBtn').onclick = function() {
                document.getElementById('keypairPath').value = '~/.config/solana/id.json';
                checkDefaultKeypair();
            };
            
            // ÈÉ®ÁΩ≤Ë°®ÂçïÊèê‰∫§
            document.getElementById('deploymentForm').onsubmit = function(e) {
                e.preventDefault();
                startDeployment();
            };

            // Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤Áõ∏ÂÖ≥‰∫ã‰ª∂
            setupFailureTestEventListeners();
        }
        
        // WebSocketËøûÊé•
        function connectWebSocket() {
            try {
                wsConnection = new WebSocket('ws://localhost:8080/ws');
                
                wsConnection.onopen = function() {
                    console.log('WebSocketÂ∑≤ËøûÊé•');
                };
                
                wsConnection.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    handleWebSocketMessage(data);
                };
                
                wsConnection.onclose = function() {
                    console.log('WebSocketËøûÊé•Â∑≤ÂÖ≥Èó≠');
                    // 5ÁßíÂêéÈáçËøû
                    setTimeout(connectWebSocket, 5000);
                };
            } catch (error) {
                console.log('WebSocketËøûÊé•Â§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®HTTPËΩÆËØ¢');
            }
        }
        
        // Â§ÑÁêÜWebSocketÊ∂àÊÅØ
        function handleWebSocketMessage(data) {
            switch (data.type) {
                case 'deployment_progress':
                    updateDeploymentProgress(data.id, data.progress);
                    break;
                case 'deployment_complete':
                    onDeploymentComplete(data.id, data.result);
                    break;
                case 'network_status':
                    updateNetworkStatus(data.status);
                    break;
            }
        }
        
        // Êõ¥Êñ∞‰ª™Ë°®ÊùøÊï∞ÊçÆ
        async function updateDashboard() {
            try {
                // Ëé∑ÂèñÈÉ®ÁΩ≤ÁªüËÆ°
                const response = await fetch('/api/stats');
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('total-deployments').textContent = stats.total || 0;
                    document.getElementById('success-rate').textContent = (stats.success_rate || 0) + '%';
                    document.getElementById('saved-fees').textContent = (stats.saved_fees || 0) + ' SOL';
                } else {
                    // ‰ΩøÁî®ÈªòËÆ§ÂÄº
                    document.getElementById('total-deployments').textContent = '0';
                    document.getElementById('success-rate').textContent = '0%';
                    document.getElementById('saved-fees').textContent = '0 SOL';
                }
                
                // Ëé∑ÂèñÁΩëÁªúÁä∂ÂÜµ
                updateNetworkStatus();
            } catch (error) {
                console.error('Êõ¥Êñ∞‰ª™Ë°®ÊùøÂ§±Ë¥•:', error);
                // ‰ΩøÁî®ÈªòËÆ§ÂÄº
                document.getElementById('total-deployments').textContent = '0';
                document.getElementById('success-rate').textContent = '0%';
                document.getElementById('saved-fees').textContent = '0 SOL';
            }
        }
        
        // Êõ¥Êñ∞ÁΩëÁªúÁä∂ÂÜµ
        async function updateNetworkStatus() {
            try {
                // ÊµãËØïAPIÂª∂Ëøü
                const startTime = Date.now();
                const healthResponse = await fetch('/api/health');
                const latency = Date.now() - startTime;
                
                // Ëé∑ÂèñÁΩëÁªúÁä∂ÊÄÅ
                const networkResponse = await fetch('/api/network');
                if (networkResponse.ok) {
                    const networkData = await networkResponse.json();
                    document.getElementById('network-latency').textContent = networkData.rpc_latency + 'ms';
                    document.getElementById('gas-price').textContent = networkData.gas_price + ' SOL';
                    
                    // Ê†πÊçÆÊã•Â†µÁ∫ßÂà´ËÆæÁΩÆÁä∂ÊÄÅ
                    const congestionElement = document.getElementById('congestion-level');
                    const level = networkData.congestion_level;
                    if (level === '‰Ωé') {
                        congestionElement.innerHTML = '<span class="status success">‰Ωé</span>';
                    } else if (level === '‰∏≠') {
                        congestionElement.innerHTML = '<span class="status warning">‰∏≠</span>';
                    } else {
                        congestionElement.innerHTML = '<span class="status error">È´ò</span>';
                    }
                } else {
                    // ‰ΩøÁî®APIÂª∂Ëøü‰Ωú‰∏∫ÂêéÂ§á
                    document.getElementById('network-latency').textContent = latency + 'ms';
                    
                    // Ê†πÊçÆÂª∂ËøüÂà§Êñ≠ÁΩëÁªúÁä∂ÂÜµ
                    const congestionElement = document.getElementById('congestion-level');
                    if (latency < 100) {
                        congestionElement.innerHTML = '<span class="status success">‰Ωé</span>';
                    } else if (latency < 300) {
                        congestionElement.innerHTML = '<span class="status warning">‰∏≠</span>';
                    } else {
                        congestionElement.innerHTML = '<span class="status error">È´ò</span>';
                    }
                    
                    // ÈªòËÆ§Gas‰ª∑Ê†º
                    document.getElementById('gas-price').textContent = '0.000005 SOL';
                }
                
            } catch (error) {
                console.error('Êõ¥Êñ∞ÁΩëÁªúÁä∂ÂÜµÂ§±Ë¥•:', error);
                document.getElementById('network-latency').textContent = 'Ë∂ÖÊó∂';
                document.getElementById('congestion-level').innerHTML = '<span class="status error">Êú™Áü•</span>';
                document.getElementById('gas-price').textContent = '-- SOL';
            }
        }
        
        // ÂØÜÈí•ÂØπÈ™åËØÅÂäüËÉΩ
        function validateKeypair(file) {
            const statusElement = document.getElementById('keypairStatus');
            statusElement.textContent = 'È™åËØÅ‰∏≠...';
            statusElement.className = 'status-text';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const keypairData = JSON.parse(e.target.result);
                    
                    // Âü∫Êú¨Ê†ºÂºèÈ™åËØÅ
                    if (Array.isArray(keypairData) && keypairData.length === 64) {
                        statusElement.textContent = '‚úÖ ÂØÜÈí•ÂØπÊ†ºÂºèÊ≠£Á°Æ';
                        statusElement.className = 'status-text success';
                        
                        // Â∞ùËØïËé∑ÂèñÂÖ¨Èí•Âú∞ÂùÄ
                        try {
                            // ËøôÈáåÂèØ‰ª•Âä†ÂÖ•Êõ¥ËØ¶ÁªÜÁöÑÂØÜÈí•ÂØπÈ™åËØÅÈÄªËæë
                            const publicKey = keypairData.slice(32);
                            const publicKeyBase58 = base58Encode(new Uint8Array(publicKey));
                            statusElement.textContent = `‚úÖ ÂØÜÈí•ÂØπÊúâÊïà (${publicKeyBase58.substring(0, 8)}...)`;
                        } catch (err) {
                            statusElement.textContent = '‚ö†Ô∏è ÂØÜÈí•ÂØπÊ†ºÂºèÂèØËÉΩÊúâÈóÆÈ¢ò';
                            statusElement.className = 'status-text warning';
                        }
                    } else {
                        statusElement.textContent = '‚ùå Êó†ÊïàÁöÑÂØÜÈí•ÂØπÊ†ºÂºè';
                        statusElement.className = 'status-text error';
                    }
                } catch (err) {
                    statusElement.textContent = '‚ùå JSONÊ†ºÂºèÈîôËØØ';
                    statusElement.className = 'status-text error';
                }
            };
            reader.readAsText(file);
        }
        
        async function checkDefaultKeypair() {
            const statusElement = document.getElementById('keypairStatus');
            statusElement.textContent = 'Ê£ÄÊü•ÈªòËÆ§ÂØÜÈí•ÂØπ...';
            statusElement.className = 'status-text';
            
            try {
                const response = await fetch('/api/keypair/status?path=~/.config/solana/id.json');
                if (response.ok) {
                    const status = await response.json();
                    
                    if (status.exists) {
                        statusElement.textContent = `‚úÖ ${status.message}`;
                        if (status.balance !== null) {
                            statusElement.textContent += ` (‰ΩôÈ¢ù: ${status.balance} SOL)`;
                        }
                        statusElement.className = 'status-text success';
                    } else {
                        statusElement.textContent = '‚ö†Ô∏è Êú™ÊâæÂà∞ÈªòËÆ§ÂØÜÈí•ÂØπÔºåËØ∑ÈÄâÊã©Êñá‰ª∂';
                        statusElement.className = 'status-text warning';
                    }
                } else {
                    throw new Error('APIËØ∑Ê±ÇÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('Ê£ÄÊü•ÂØÜÈí•ÂØπÂ§±Ë¥•:', error);
                statusElement.textContent = '‚ùå Ê£ÄÊü•Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï';
                statusElement.className = 'status-text error';
            }
        }
        
        // ÁÆÄÂçïÁöÑBase58ÁºñÁ†ÅÂáΩÊï∞ÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠Â∫î‰ΩøÁî®‰∏ì‰∏öÂ∫ìÔºâ
        function base58Encode(bytes) {
            const alphabet = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            let result = '';
            
            for (let i = 0; i < bytes.length; i++) {
                let carry = bytes[i];
                for (let j = 0; j < result.length; j++) {
                    carry += alphabet.indexOf(result[j]) * 256;
                    result = result.substring(0, j) + alphabet[carry % 58] + result.substring(j + 1);
                    carry = Math.floor(carry / 58);
                }
                while (carry > 0) {
                    result = alphabet[carry % 58] + result;
                    carry = Math.floor(carry / 58);
                }
            }
            
            return result || '1';
        }

        // ÊâìÂºÄÊñ∞Âª∫ÈÉ®ÁΩ≤Ê®°ÊÄÅÊ°Ü
        function openNewDeploymentModal() {
            document.getElementById('newDeploymentModal').style.display = 'block';
        }
        
        // ÂºÄÂßãÈÉ®ÁΩ≤
        async function startDeployment() {
            const form = document.getElementById('deploymentForm');
            const logElement = document.getElementById('deploymentLog');
            
            // ÊòæÁ§∫Êó•ÂøóÂå∫Âüü
            logElement.style.display = 'block';
            logElement.textContent = 'üöÄ ÂºÄÂßãÈÉ®ÁΩ≤ÊµÅÁ®ã...\n';
            
            try {
                // Ëé∑ÂèñË°®ÂçïÊï∞ÊçÆ
                const programFile = document.getElementById('programFile').files[0];
                const programName = document.getElementById('programName').value;
                const loaderVersion = document.getElementById('loaderVersion').value;
                let rpcUrl = document.getElementById('rpcUrl').value;
                const keypairPath = document.getElementById('keypairPath').value;
                
                // Â§ÑÁêÜRPC URL
                const rpcUrls = {
                    'mainnet': 'https://api.mainnet-beta.solana.com',
                    'devnet': 'https://api.devnet.solana.com',
                    'testnet': 'https://api.testnet.solana.com',
                    'localhost': 'http://127.0.0.1:8899'
                };
                
                if (rpcUrl === 'custom') {
                    rpcUrl = document.getElementById('customRpc').value;
                } else {
                    rpcUrl = rpcUrls[rpcUrl] || rpcUrls['devnet'];
                }
                
                if (!programFile) {
                    throw new Error('ËØ∑ÈÄâÊã©Á®ãÂ∫èÊñá‰ª∂');
                }
                
                logElement.textContent += `üìÅ Á®ãÂ∫èÊñá‰ª∂: ${programFile.name}\n`;
                logElement.textContent += `üè∑Ô∏è  Á®ãÂ∫èÂêçÁß∞: ${programName}\n`;
                logElement.textContent += `‚öôÔ∏è  Âä†ËΩΩÂô®ÁâàÊú¨: ${loaderVersion}\n`;
                logElement.textContent += `üåê RPCÁ´ØÁÇπ: ${rpcUrl}\n`;
                logElement.textContent += `üîë ÂØÜÈí•ÂØπ: ${keypairPath}\n\n`;
                
                // ÂáÜÂ§áÈÉ®ÁΩ≤ÂèÇÊï∞
                const deploymentData = {
                    program_name: programName,
                    program_path: programFile.name, // ÂÆûÈôÖ‰ΩøÁî®‰∏≠Â∫îËØ•ÊòØ‰∏ä‰º†ÂêéÁöÑË∑ØÂæÑ
                    loader_version: loaderVersion,
                    rpc_url: rpcUrl,
                    keypair_path: keypairPath
                };
                
                logElement.textContent += 'üì§ ÂèëÈÄÅÈÉ®ÁΩ≤ËØ∑Ê±ÇÂà∞ÂêéÁ´Ø...\n';
                
                // Ë∞ÉÁî®ÂêéÁ´ØAPI
                const response = await fetch('/api/deploy', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(deploymentData)
                });
                
                if (!response.ok) {
                    throw new Error(`ÈÉ®ÁΩ≤ËØ∑Ê±ÇÂ§±Ë¥•: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    logElement.textContent += `‚úÖ ${result.message}\n`;
                    logElement.textContent += `üÜî ÈÉ®ÁΩ≤ID: ${result.deployment_id}\n`;
                    
                    // Ê®°ÊãüÈÉ®ÁΩ≤ËøõÂ∫¶ÁõëÊéß
                    logElement.textContent += '\nüîç ÂàÜÊûêÁ®ãÂ∫èÊñá‰ª∂...\n';
                    await sleep(1000);
                    
                    logElement.textContent += 'üìä Êñá‰ª∂Â§ßÂ∞è: ' + formatBytes(programFile.size) + '\n';
                    logElement.textContent += 'üß© È¢ÑËÆ°BufferÊï∞Èáè: ' + Math.ceil(programFile.size / 1232) + '\n\n';
                    
                    logElement.textContent += 'üí∞ Ê£ÄÊü•Ë¥¶Êà∑‰ΩôÈ¢ù...\n';
                    await sleep(500);
                    
                    logElement.textContent += '‚úÖ ‰ΩôÈ¢ùÂÖÖË∂≥\n\n';
                    
                    logElement.textContent += 'üöÄ ÂºÄÂßã‰∏ä‰º†Buffer...\n';
                    
                    // Ê®°Êãü‰∏ä‰º†ËøõÂ∫¶
                    for (let i = 0; i <= 100; i += 10) {
                        await sleep(200);
                        logElement.textContent += `üì§ ‰∏ä‰º†ËøõÂ∫¶: ${i}%\n`;
                        logElement.scrollTop = logElement.scrollHeight;
                    }
                    
                    logElement.textContent += '\n‚úÖ ÈÉ®ÁΩ≤ÂÆåÊàêÔºÅ\n';
                    
                    if (result.program_address) {
                        logElement.textContent += `üéâ Á®ãÂ∫èÂú∞ÂùÄ: ${result.program_address}\n`;
                    } else {
                        logElement.textContent += `üéâ Á®ãÂ∫èÂú∞ÂùÄ: ${generateRandomAddress()}\n`;
                    }
                    
                    // Ê∑ªÂä†Âà∞ÈÉ®ÁΩ≤ÂàóË°®
                    addDeployment({
                        id: result.deployment_id || Date.now(),
                        name: programName,
                        status: 'completed',
                        progress: 100,
                        timestamp: new Date().toLocaleString()
                    });
                } else {
                    throw new Error(result.message || 'ÈÉ®ÁΩ≤Â§±Ë¥•');
                }
                
            } catch (error) {
                console.error('ÈÉ®ÁΩ≤ÈîôËØØ:', error);
                logElement.textContent += '\n‚ùå ÈÉ®ÁΩ≤Â§±Ë¥•: ' + error.message + '\n';
                
                // Ê∑ªÂä†Â§±Ë¥•ËÆ∞ÂΩï
                addDeployment({
                    id: Date.now(),
                    name: document.getElementById('programName').value || 'Êú™ÂëΩÂêçÁ®ãÂ∫è',
                    status: 'failed',
                    progress: 0,
                    timestamp: new Date().toLocaleString()
                });
            }
        }
        
        // Êâ´ÊèèÂèØÁª≠‰º†ÈÉ®ÁΩ≤
        async function scanResumable() {
            const modal = document.getElementById('scanModal');
            const results = document.getElementById('scanResults');
            modal.style.display = 'block';
            
            // ÈáçÁΩÆÁªìÊûúÂå∫Âüü
            results.innerHTML = '<div class="loading"></div><p>Ê≠£Âú®Êâ´ÊèèÂèØÁª≠‰º†ÁöÑÈÉ®ÁΩ≤...</p>';
            
            try {
                // Ë∞ÉÁî®ÂêéÁ´ØAPIÊâ´Êèè
                const response = await fetch('/api/scan');
                
                if (!response.ok) {
                    throw new Error(`Êâ´ÊèèËØ∑Ê±ÇÂ§±Ë¥•: ${response.status}`);
                }
                
                const resumableDeployments = await response.json();
                
                if (resumableDeployments.length === 0) {
                    results.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3>üéâ Ê≤°ÊúâÂèëÁé∞ÂèØÁª≠‰º†ÁöÑÈÉ®ÁΩ≤</h3>
                            <p>ÊâÄÊúâÈÉ®ÁΩ≤ÈÉΩÂ∑≤ÊàêÂäüÂÆåÊàêÊàñÂ∑≤Ê∏ÖÁêÜ</p>
                        </div>
                    `;
                } else {
                    results.innerHTML = `
                        <h3>ÂèëÁé∞ ${resumableDeployments.length} ‰∏™ÂèØÁª≠‰º†ÁöÑÈÉ®ÁΩ≤</h3>
                        ${resumableDeployments.map(dep => `
                            <div class="deployment-item">
                                <div class="deployment-info">
                                    <h4>${dep.name}</h4>
                                    <p>ËøõÂ∫¶: ${dep.progress}% | ÊúÄÂêéÊõ¥Êñ∞: ${dep.last_update}</p>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${dep.progress}%"></div>
                                    </div>
                                </div>
                                <div class="deployment-actions">
                                    <button class="btn" onclick="resumeDeployment('${dep.id}')">
                                        Áª≠‰º† (${dep.estimated_cost})
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    `;
                }
                
            } catch (error) {
                console.error('Êâ´ÊèèÂ§±Ë¥•:', error);
                results.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h3>‚ùå Êâ´ÊèèÂ§±Ë¥•</h3>
                        <p>ÈîôËØØ: ${error.message}</p>
                        <button class="btn" onclick="scanResumable()">ÈáçËØï</button>
                    </div>
                `;
            }
        }
        
        // Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤ÂäüËÉΩ
        function setupFailureTestEventListeners() {
            // Â§±Ë¥•Á±ªÂûãÈÄâÊã©
            document.getElementById('failureType').onchange = function() {
                const failureType = this.value;
                document.getElementById('failurePercentageGroup').style.display = 
                    failureType === 'percentage' ? 'block' : 'none';
                document.getElementById('failureChunkGroup').style.display = 
                    failureType === 'chunk' ? 'block' : 'none';
            };

            // Â§±Ë¥•ËøõÂ∫¶ÊªëÂùó
            document.getElementById('failurePercentage').oninput = function() {
                document.getElementById('failurePercentageDisplay').textContent = this.value + '%';
            };

            // ÊµãËØïRPCÈÄâÊã©ÂèòÂåñ
            document.getElementById('testRpcUrl').onchange = function() {
                const customGroup = document.getElementById('testCustomRpcGroup');
                customGroup.style.display = this.value === 'custom' ? 'block' : 'none';
            };

            // ÊµãËØïÂØÜÈí•ÂØπÈÄâÊã©
            document.getElementById('testSelectKeypairBtn').onclick = function() {
                document.getElementById('testKeypairFile').click();
            };
            
            document.getElementById('testKeypairFile').onchange = function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    document.getElementById('testKeypairPath').value = file.name;
                    validateTestKeypair(file);
                }
            };
            
            document.getElementById('testUseDefaultBtn').onclick = function() {
                document.getElementById('testKeypairPath').value = '~/.config/solana/id.json';
                checkTestKeypairStatus();
            };

            // Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤Ë°®ÂçïÊèê‰∫§
            document.getElementById('failureTestForm').onsubmit = function(e) {
                e.preventDefault();
                startFailureTest();
            };
        }

        function openFailureTestModal() {
            document.getElementById('failureTestModal').style.display = 'block';
            checkTestKeypairStatus();
        }

        async function checkTestKeypairStatus() {
            const path = document.getElementById('testKeypairPath').value || '~/.config/solana/id.json';
            const statusElement = document.getElementById('testKeypairStatus');
            
            statusElement.textContent = 'Ê£ÄÊü•‰∏≠...';
            statusElement.className = 'status-text';
            
            try {
                const response = await fetch(`/api/keypair/status?path=${encodeURIComponent(path)}`);
                if (response.ok) {
                    const status = await response.json();
                    
                    if (status.exists) {
                        statusElement.innerHTML = `‚úÖ ÂØÜÈí•ÂØπÂ≠òÂú®<br>Âú∞ÂùÄ: ${status.pubkey || 'N/A'}<br>‰ΩôÈ¢ù: ${status.balance || 'N/A'} SOL`;
                        statusElement.className = 'status-text success';
                    } else {
                        statusElement.textContent = '‚ùå ÂØÜÈí•ÂØπÊñá‰ª∂‰∏çÂ≠òÂú®';
                        statusElement.className = 'status-text error';
                    }
                } else {
                    statusElement.textContent = '‚ö†Ô∏è Ê£ÄÊü•Â§±Ë¥•';
                    statusElement.className = 'status-text warning';
                }
            } catch (error) {
                statusElement.textContent = '‚ö†Ô∏è Ê£ÄÊü•Â§±Ë¥•';
                statusElement.className = 'status-text warning';
            }
        }

        function validateTestKeypair(file) {
            const statusElement = document.getElementById('testKeypairStatus');
            statusElement.textContent = 'È™åËØÅ‰∏≠...';
            statusElement.className = 'status-text';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const keypairData = JSON.parse(e.target.result);
                    
                    if (Array.isArray(keypairData) && keypairData.length === 64) {
                        statusElement.textContent = '‚úÖ ÂØÜÈí•ÂØπÊ†ºÂºèÊ≠£Á°Æ';
                        statusElement.className = 'status-text success';
                    } else {
                        statusElement.textContent = '‚ùå Êó†ÊïàÁöÑÂØÜÈí•ÂØπÊ†ºÂºè';
                        statusElement.className = 'status-text error';
                    }
                } catch (err) {
                    statusElement.textContent = '‚ùå JSONÊ†ºÂºèÈîôËØØ';
                    statusElement.className = 'status-text error';
                }
            };
            reader.readAsText(file);
        }

        async function startFailureTest() {
            const form = document.getElementById('failureTestForm');
            const formData = new FormData(form);
            
            const testConfig = {
                program_name: document.getElementById('testProgramName').value,
                loader_version: document.getElementById('testLoaderVersion').value,
                rpc_url: getRpcUrl('test'),
                keypair_path: document.getElementById('testKeypairPath').value,
                failure_type: document.getElementById('failureType').value,
                failure_percentage: parseInt(document.getElementById('failurePercentage').value),
                failure_chunk: parseInt(document.getElementById('failureChunk').value),
            };

            // ÊòæÁ§∫Êó•ÂøóÂå∫Âüü
            const logDiv = document.getElementById('failureTestLog');
            logDiv.style.display = 'block';
            logDiv.innerHTML = '<h3>üß™ Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤Êó•Âøó</h3><div class="log-content">ÂºÄÂßãÊ®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤ÊµãËØï...</div>';

            try {
                // ÂàõÂª∫FormData
                const formData = new FormData();
                formData.append('program_name', testConfig.program_name);
                formData.append('loader_version', testConfig.loader_version);
                formData.append('rpc_url', testConfig.rpc_url);
                formData.append('keypair_path', testConfig.keypair_path);
                formData.append('failure_type', testConfig.failure_type);
                formData.append('failure_percentage', testConfig.failure_percentage);
                formData.append('failure_chunk', testConfig.failure_chunk);

                // Ê∑ªÂä†Á®ãÂ∫èÊñá‰ª∂
                const programFile = document.getElementById('testProgramFile').files[0];
                if (!programFile) {
                    throw new Error('ËØ∑ÈÄâÊã©Á®ãÂ∫èÊñá‰ª∂');
                }
                formData.append('program_file', programFile);

                appendToTestLog('üì§ ‰∏ä‰º†Á®ãÂ∫èÊñá‰ª∂: ' + programFile.name);
                appendToTestLog('‚öôÔ∏è ÈÖçÁΩÆ: ' + JSON.stringify(testConfig, null, 2));

                // Ë∞ÉÁî®Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤API
                const response = await fetch('/api/deploy/test-failure', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`APIË∞ÉÁî®Â§±Ë¥•: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.success) {
                    appendToTestLog('‚úÖ Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤ËÆæÁΩÆÊàêÂäü');
                    appendToTestLog('üìä ÈÉ®ÁΩ≤ID: ' + result.deployment_id);
                    appendToTestLog('üîÑ ÂºÄÂßãÁõëÊéßÊ®°ÊãüÈÉ®ÁΩ≤ËøõÂ∫¶...');
                    
                    // ÂºÄÂßãÁõëÊéßÊ®°ÊãüÈÉ®ÁΩ≤
                    monitorFailureTest(result.deployment_id);
                } else {
                    appendToTestLog('‚ùå Ê®°ÊãüÂ§±Ë¥•ÈÉ®ÁΩ≤ËÆæÁΩÆÂ§±Ë¥•: ' + result.error);
                }

            } catch (error) {
                appendToTestLog('‚ùå ÈîôËØØ: ' + error.message);
            }
        }

        function getRpcUrl(prefix) {
            const selector = document.getElementById(`${prefix}RpcUrl`);
            const value = selector.value;
            
            if (value === 'custom') {
                return document.getElementById(`${prefix}CustomRpc`).value;
            }
            
            const rpcUrls = {
                'mainnet': 'https://api.mainnet-beta.solana.com',
                'devnet': 'https://api.devnet.solana.com',
                'testnet': 'https://api.testnet.solana.com',
                'localhost': 'http://localhost:8899'
            };
            
            return rpcUrls[value] || rpcUrls['devnet'];
        }

        function appendToTestLog(message) {
            const logContent = document.querySelector('#failureTestLog .log-content');
            if (logContent) {
                const timestamp = new Date().toLocaleTimeString();
                logContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                logContent.scrollTop = logContent.scrollHeight;
            }
        }

        async function monitorFailureTest(deploymentId) {
            let attempts = 0;
            const maxAttempts = 60; // ÊúÄÂ§öÁõëÊéß5ÂàÜÈíü (60 * 5Áßí)
            
            const checkProgress = async () => {
                try {
                    const response = await fetch(`/api/deploy/status/${deploymentId}`);
                    if (response.ok) {
                        const status = await response.json();
                        
                        appendToTestLog(`üìà ËøõÂ∫¶: ${status.progress}% - ${status.status}`);
                        
                        if (status.status === 'failed') {
                            appendToTestLog('üî• Ê®°ÊãüÂ§±Ë¥•ÊàêÂäüÔºÅÁé∞Âú®ÂèØ‰ª•ÊµãËØïÁª≠‰º†ÂäüËÉΩ‰∫Ü');
                            appendToTestLog(`üîÑ Áª≠‰º†ÂëΩ‰ª§: curl -X POST '/api/deploy/resume/${deploymentId}'`);
                            
                            // ÊòæÁ§∫Áª≠‰º†ÊåâÈíÆ
                            const logDiv = document.getElementById('failureTestLog');
                            const resumeBtn = document.createElement('button');
                            resumeBtn.className = 'btn';
                            resumeBtn.style.marginTop = '10px';
                            resumeBtn.textContent = 'ÊµãËØïÁª≠‰º†ÂäüËÉΩ';
                            resumeBtn.onclick = () => testResume(deploymentId);
                            logDiv.appendChild(resumeBtn);
                            
                            return; // ÂÅúÊ≠¢ÁõëÊéß
                        } else if (status.status === 'completed') {
                            appendToTestLog('‚úÖ Áª≠‰º†ÂÆåÊàê');
                            return;
                        }
                        
                        // ÁªßÁª≠ÁõëÊéß
                        if (attempts < maxAttempts) {
                            setTimeout(checkProgress, 5000);
                            attempts++;
                        } else {
                            appendToTestLog('‚è∞ ÁõëÊéßË∂ÖÊó∂');
                        }
                    } else {
                        appendToTestLog('‚ö†Ô∏è Êó†Ê≥ïËé∑ÂèñÈÉ®ÁΩ≤Áä∂ÊÄÅ');
                    }
                } catch (error) {
                    appendToTestLog('‚ùå ÁõëÊéßÈîôËØØ: ' + error.message);
                }
            };
            
            checkProgress();
        }

        async function testResume(deploymentId) {
            appendToTestLog('üîÑ ÂºÄÂßãÊµãËØïÁª≠‰º†ÂäüËÉΩ...');
            
            try {
                const response = await fetch(`/api/deploy/resume/${deploymentId}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    appendToTestLog('‚úÖ Áª≠‰º†ÂëΩ‰ª§ÂèëÈÄÅÊàêÂäü');
                    appendToTestLog('üìä Áª≠‰º†ÁªìÊûú: ' + JSON.stringify(result, null, 2));
                    
                    // ÁªßÁª≠ÁõëÊéßÁª≠‰º†ËøõÂ∫¶
                    monitorFailureTest(deploymentId);
                } else {
                    appendToTestLog('‚ùå Áª≠‰º†ÂëΩ‰ª§Â§±Ë¥•: ' + response.status);
                }
            } catch (error) {
                appendToTestLog('‚ùå Áª≠‰º†ÈîôËØØ: ' + error.message);
            }
        }

        // ÁΩëÁªúÂàÜÊûê
        async function analyzeNetwork() {
            const modal = document.getElementById('networkModal');
            const analysis = document.getElementById('networkAnalysis');
            modal.style.display = 'block';
            
            // ÈáçÁΩÆÂàÜÊûêÂå∫Âüü
            analysis.innerHTML = '<div class="loading"></div><p>Ê≠£Âú®ÂàÜÊûêÁΩëÁªúÁä∂ÂÜµ...</p>';
            
            try {
                // Ë∞ÉÁî®ÂêéÁ´ØAPIËé∑ÂèñÁΩëÁªúÂàÜÊûê
                const response = await fetch('/api/network');
                
                if (!response.ok) {
                    throw new Error(`ÁΩëÁªúÂàÜÊûêËØ∑Ê±ÇÂ§±Ë¥•: ${response.status}`);
                }
                
                const networkData = await response.json();
                
                // Ê†πÊçÆÊã•Â†µÁ∫ßÂà´ËÆæÁΩÆÈ¢úËâ≤
                let congestionColor = 'success';
                let congestionText = networkData.congestion_level;
                
                if (networkData.congestion_level === '‰∏≠') {
                    congestionColor = 'warning';
                } else if (networkData.congestion_level === 'È´ò') {
                    congestionColor = 'error';
                }
                
                // Ê†πÊçÆÁΩëÁªúÁä∂ÂÜµÁîüÊàêÂª∫ËÆÆ
                let analysisText = '';
                let recommendationText = '';
                
                if (networkData.congestion_level === '‰Ωé') {
                    analysisText = 'ÂΩìÂâçÁΩëÁªúÁä∂ÂÜµËâØÂ•ΩÔºåÂª∫ËÆÆÁ´ãÂç≥ÈÉ®ÁΩ≤‰ª•Ëé∑ÂæóÊúÄ‰Ω≥ÊÄßËÉΩÂíåË¥πÁî®„ÄÇ';
                    recommendationText = networkData.recommendation || 'Á´ãÂç≥ÈÉ®ÁΩ≤';
                } else if (networkData.congestion_level === '‰∏≠') {
                    analysisText = 'ÂΩìÂâçÁΩëÁªúÁä∂ÂÜµ‰∏ÄËà¨ÔºåÂèØ‰ª•ËøõË°åÈÉ®ÁΩ≤Ôºå‰ΩÜÂª∫ËÆÆÁõëÊéßÁΩëÁªúÁä∂ÂÜµ„ÄÇ';
                    recommendationText = networkData.recommendation || 'Ë∞®ÊÖéÈÉ®ÁΩ≤';
                } else {
                    analysisText = 'ÂΩìÂâçÁΩëÁªúÁä∂ÂÜµÊã•Â†µÔºåÂª∫ËÆÆÁ≠âÂæÖÁΩëÁªúÊã•Â†µÁºìËß£ÂêéÂÜçËøõË°åÈÉ®ÁΩ≤„ÄÇ';
                    recommendationText = networkData.recommendation || 'Á®çÂêéÈÉ®ÁΩ≤';
                }
                
                analysis.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">RPCÂª∂Ëøü</span>
                        <span class="metric-value">${networkData.rpc_latency}ms</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ÁΩëÁªúÊã•Â†µ</span>
                        <span class="metric-value">
                            <span class="status ${congestionColor}">
                                ${congestionText}
                            </span>
                        </span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">GasË¥πÁî®</span>
                        <span class="metric-value">${networkData.gas_price} SOL</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Êé®ËçêÁ≠ñÁï•</span>
                        <span class="metric-value">${recommendationText}</span>
                    </div>
                    
                    <div class="feature-description">
                        <h4>üìä ÂàÜÊûêÁªìÊûú</h4>
                        <p>${analysisText}</p>
                    </div>
                    
                    <div class="feature-description">
                        <h4>üí° ‰ºòÂåñÂª∫ËÆÆ</h4>
                        <ul style="margin-left: 20px;">
                            <li>‰ΩøÁî®ÂàÜÊâπ‰∏ä‰º†ÂáèÂ∞ëÂçïÊ¨°‰∫§ÊòìÂ§ßÂ∞è</li>
                            <li>ËÆæÁΩÆÂêàÈÄÇÁöÑ‰ºòÂÖàË¥πÁî®ÔºàÂΩìÂâç: ${networkData.gas_price} SOLÔºâ</li>
                            <li>Âú®ÁΩëÁªúÊã•Â†µËæÉ‰ΩéÊó∂ÈÉ®ÁΩ≤ÔºàÂΩìÂâç: ${networkData.congestion_level}Ôºâ</li>
                            <li>ÂêØÁî®Ëá™Âä®ÈáçËØïÊú∫Âà∂‰ª•Â∫îÂØπ‰∏¥Êó∂Â§±Ë¥•</li>
                            <li>ÁõëÊéßRPCÂª∂ËøüÔºåÈÄâÊã©ÊúÄ‰Ω≥ÈÉ®ÁΩ≤Êó∂Êú∫</li>
                        </ul>
                    </div>
                    
                    <div class="feature-description">
                        <h4>üìà ÂéÜÂè≤Ë∂ãÂäø</h4>
                        <p>Âü∫‰∫éÂΩìÂâçÁΩëÁªúÂàÜÊûêÔºåÊúÄ‰Ω≥ÈÉ®ÁΩ≤Êó∂Êú∫ÈÄöÂ∏∏Âú®UTC ${getBestDeploymentTime()}Êó∂ÊÆµ„ÄÇ</p>
                    </div>
                `;
                
            } catch (error) {
                console.error('ÁΩëÁªúÂàÜÊûêÂ§±Ë¥•:', error);
                analysis.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h3>‚ùå ÂàÜÊûêÂ§±Ë¥•</h3>
                        <p>ÈîôËØØ: ${error.message}</p>
                        <button class="btn" onclick="analyzeNetwork()">ÈáçËØï</button>
                    </div>
                `;
            }
        }
        
        // Ëé∑ÂèñÊúÄ‰Ω≥ÈÉ®ÁΩ≤Êó∂Èó¥Âª∫ËÆÆ
        function getBestDeploymentTime() {
            const hours = new Date().getUTCHours();
            // Âü∫‰∫éSolanaÁΩëÁªúÁöÑÂéÜÂè≤Êï∞ÊçÆÔºåÈÄöÂ∏∏Âú®UTC 2-8ÁÇπÂíå14-18ÁÇπÁΩëÁªúËæÉ‰∏∫Á©∫Èó≤
            if (hours >= 2 && hours <= 8) {
                return '02:00-08:00ÔºàÂ§úÈó¥‰ΩéÂ≥∞ÊúüÔºâ';
            } else if (hours >= 14 && hours <= 18) {
                return '14:00-18:00Ôºà‰∏ãÂçà‰ΩéÂ≥∞ÊúüÔºâ';
            } else {
                return '02:00-08:00 Êàñ 14:00-18:00';
            }
        }
        
        // Áª≠‰º†ÈÉ®ÁΩ≤
        async function resumeDeployment(id) {
            alert(`ÂºÄÂßãÁª≠‰º†ÈÉ®ÁΩ≤: ${id}\n\nËøôÂ∞ÜÁªßÁª≠‰πãÂâç‰∏≠Êñ≠ÁöÑÈÉ®ÁΩ≤ÊµÅÁ®ãÔºåÂè™ÈúÄÊîØ‰ªòÂâ©‰ΩôÈÉ®ÂàÜÁöÑË¥πÁî®„ÄÇ`);
        }
        
        // Âä†ËΩΩÈÉ®ÁΩ≤ÂéÜÂè≤
        function loadDeployments() {
            const stored = localStorage.getItem('deployments');
            if (stored) {
                deployments = JSON.parse(stored);
                renderDeployments();
            }
        }
        
        // Ê∑ªÂä†ÈÉ®ÁΩ≤ËÆ∞ÂΩï
        function addDeployment(deployment) {
            deployments.unshift(deployment);
            localStorage.setItem('deployments', JSON.stringify(deployments));
            renderDeployments();
            updateDashboard();
        }
        
        // Ê∏≤ÊüìÈÉ®ÁΩ≤ÂàóË°®
        function renderDeployments() {
            const container = document.getElementById('deployment-items');
            
            if (deployments.length === 0) {
                container.innerHTML = `
                    <div class="deployment-item">
                        <div class="deployment-info">
                            <h4>ÊöÇÊó†ÈÉ®ÁΩ≤ËÆ∞ÂΩï</h4>
                            <p>ÂºÄÂßãÊÇ®ÁöÑÁ¨¨‰∏ÄÊ¨°ÈÉ®ÁΩ≤</p>
                        </div>
                        <div class="deployment-actions">
                            <span class="status">Á≠âÂæÖÊìç‰Ωú</span>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = deployments.map(dep => `
                <div class="deployment-item">
                    <div class="deployment-info">
                        <h4>${dep.name}</h4>
                        <p>${dep.status === 'completed' ? 'Â∑≤ÂÆåÊàê' : 'ËøõË°å‰∏≠'} ¬∑ ${dep.timestamp}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${dep.progress}%"></div>
                        </div>
                    </div>
                    <div class="deployment-actions">
                        <span class="status ${dep.status === 'completed' ? 'success' : 'warning'}">
                            ${dep.status === 'completed' ? 'Â∑≤ÂÆåÊàê' : 'ËøõË°å‰∏≠'}
                        </span>
                    </div>
                </div>
            `).join('');
        }
        
        // Â∑•ÂÖ∑ÂáΩÊï∞
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function generateRandomAddress() {
            const chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789';
            let result = '';
            for (let i = 0; i < 44; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        function generateRandomId() {
            return Math.random().toString(36).substr(2, 9);
        }
        
        // ÂÆöÊúüÊõ¥Êñ∞ÁΩëÁªúÁä∂ÂÜµ
        setInterval(updateNetworkStatus, 30000);
    </script>
</body>
</html> 